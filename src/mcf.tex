\documentclass[UTF8,a4paper]{ctexart}
\usepackage{taoda}
\usepackage[lmargin=2cm,rmargin=2cm,tmargin=2cm,bmargin=2cm]{geometry}

\title{Notes on Minimal Cost Flow}
\author{陶大}

\begin{document}

\maketitle
\tableofcontents

\section{Definitions}

For a directed graph $G=(V, E)$, there is nonnegative capacity $u_e$ associated with each edge
and balance $b_v$ with each vertex.
For a flow over edge $e$, each unit costs $c_e$.

\[
    \min \sum_{e\in E} c_e x_e
\]
s.t.,
\begin{align}
    0\leqslant x_e \leqslant u_e,\qquad \forall e\in E\\
    \sum_{e\text{ from }v} x_e - \sum_{e\text{ into }v} x_e = b_v,\qquad \forall v\in V
\end{align}

Vertices with positive $b_v$ are called \emph{supplies},
and those with negative ones, \emph{demands}.
Solutions satisfy constraints are \emph{feasible}.

Without loss of generality, we can assume there is exactly one supply and one demand.
They are called the \emph{source} and the \emph{sink} respectively.

\begin{remark}
    Usually, we are interested in min-cost max-flow solutions.
    Let $G=(V, E, {u_e}, {c_e}, {b_v})$ be a MCF setting with a single source and a single sink,
    where a min-cost max flow is desired.
    Then we construct $G'=(V', E', {u'_e}, {c'_e}, {b'_v})$ as follows.
    \begin{align}
        V'&=V,\\
        E'&=E\cup\{e'\},\\
        u'_e&=\begin{cases}
            u_e,&\forall e\in E,\\
            +\infty,&e',
        \end{cases}\\
        c'_e&=\begin{cases}
            c_e,&\forall e\in E,\\
            -\infty,&e',
        \end{cases}\\
        b'_v&=\vec{0}
    \end{align}
    where $e'$ connects the only sink back to the source.
    The key is to minimize total cost, flow over $e'$ must be maximal.
    To achieve this, $-\infty$ is not necessary for $c_{e'}$.
    $-\sum_{e\in E}\abs{c_e}$ is small enough.
\end{remark}

\section{Applications}

\subsection{Linear programs with consecutive 1's in columns}

Let us take a look at an example.
\[
    \min \sum_i c_i x_i
\]
s.t.
\begin{align*}
    \begin{bmatrix}
        0&1&0&1&1\\
        1&1&0&0&1\\
        1&1&1&0&0\\
        1&1&1&0&0
    \end{bmatrix}
    x &\geq \begin{bmatrix}
        5\\
        12\\
        10\\
        6
    \end{bmatrix}
    \\
    x&\geq 0
\end{align*}

We first make the first constraint into an equality by introducing surplus variable $y$,
and then a redundant row $0\cdot x + 0\cdot y=0$.
So we get
\begin{align*}
    \begin{bmatrix}
        0&1&0&1&1& -1&0&0&0\\
        1&1&0&0&1& 0&-1&0&0\\
        1&1&1&0&0& 0&0&-1&0\\
        1&1&1&0&0& 0&0&0&-1\\
        0&0&0&0&0& 0&0&0&0
    \end{bmatrix}
    \begin{bmatrix}
        x\\
        y
    \end{bmatrix}
    &=\begin{bmatrix}
        5\\
        12\\
        10\\
        6\\
        0
    \end{bmatrix}
    \\ x&\geq 0
    \\ y&\geq 0
\end{align*}

Then we perform the following operation from bottom to up:
we subtract row $i$ by row $i-1$ for each $i$.
So we get
\[
    \min \sum_i c_i x_i
\]
s.t.
\begin{align*}
    \begin{bmatrix}
        0&1&0&1&1& -1&0&0&0\\
        1&0&0&-1&0& 1&-1&0&0\\
        0&0&1&0&-1& 0&1&-1&0\\
        0&0&0&0&0& 0&0&1&-1\\
        -1&-1&-1&0&0& 0&0&0&1
    \end{bmatrix}
    \begin{bmatrix}
        x\\
        y
    \end{bmatrix}
    &=\begin{bmatrix}
        5\\
        7\\
        -2\\
        -4\\
        -6
    \end{bmatrix}
    \\ x&\geq 0
    \\ y&\geq 0
\end{align*}
This is actually a MCF problem illustrated by Fig~\ref{fig:app:lp}.

\begin{figure}
    \begin{center}
        \includegraphics{fig/application-lp.pdf}
    \end{center}
    \caption{Formulating a linear program with consecutive 1's as a MCF problem}
    \label{fig:app:lp}
\end{figure}

\end{document}
